name: Template Cleanup
on:
  push:
    branches: [ main, master ]
  workflow_dispatch: # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é

permissions:
  contents: write # –Ø–≤–Ω–æ –¥–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å

jobs:
  template-cleanup:
    if: github.repository != 'ObjReponse/web-content-processor-interview'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Cleanup template
        run: |
          # –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
          REPO_NAME="${GITHUB_REPOSITORY#*/}"
          
          echo "Cleaning up template for repository: ${GITHUB_REPOSITORY}"
          
          # –û–±–Ω–æ–≤–ª—è–µ–º go.mod —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º module path
          sed -i "s|github.com/ObjReponse/web-content-processor-interview|github.com/${GITHUB_REPOSITORY}|g" go.mod
          
          # –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–ø–æ—Ä—Ç—ã –≤ main.go
          sed -i "s|github.com/ObjReponse/web-content-processor-interview/processor|github.com/${GITHUB_REPOSITORY}/processor|g" main.go
          
          # –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª-–º–∞—Ä–∫–µ—Ä —á—Ç–æ cleanup –≤—ã–ø–æ–ª–Ω–µ–Ω
          echo "Repository initialized from template on $(date)" > .template-initialized
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if git diff --quiet; then
            echo "No changes to commit"
            exit 0
          fi
          
          # –ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add .
          git commit -m "üöÄ Initialize repository from template
          
          - Updated module path to match repository
          - Updated imports in source files
          - Template cleanup completed"
          
          git push

      - name: Remove cleanup workflow
        run: |
          # –£–¥–∞–ª—è–µ–º —ç—Ç–æ—Ç workflow –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
          git rm .github/template-cleanup.yml
          git commit -m "üßπ Remove template cleanup workflow" || exit 0
          git push || exit 0